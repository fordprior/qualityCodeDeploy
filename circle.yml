machine:
  services:
    - docker

dependencies:
  post:
    - docker build -t $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/newman:$CIRCLE_SHA1 .

test:
  post:
    - docker run -p 3000:3000 --name newman $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/newman:$CIRCLE_SHA1 --url="$COLLECTION_URL"
#   - docker run -p 3000:3000 --name newman2 $AWS_ACCOUNT_ID.dkr.ecr.us-east-1.amazonaws.com/newman:$CIRCLE_SHA1 --collection="etc/newman/prod-check.postman_collection.json" --html "newman_report.html"

notify:
  webhooks:
    - url: $JENKINS/job/$PROJECT/build?token=$TOKEN
#   - NOTE: there is also another webhook curl within the circleCI project that is called in addition to this
